<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <!-- Visualização de formulário para credenciais -->
    <record id="view_ai_system_credentials_form" model="ir.ui.view">
        <field name="name">ai.system.credentials.form</field>
        <field name="model">ai.system.credentials</field>
        <field name="arch" type="xml">
            <form string="Credenciais do Sistema de IA">
                <header>
                    <button name="action_test_connection" string="Testar Conexão" type="object" class="oe_highlight"/>
                    <button name="action_sync_to_yaml" string="Sincronizar com YAML" type="object" class="btn btn-primary"/>
                </header>
                <sheet>
                    <div class="oe_title">
                        <h1>
                            <field name="name" placeholder="Nome das Credenciais"/>
                        </h1>
                    </div>
                    <group>
                        <group>
                            <field name="account_id"/>
                            <field name="token" readonly="1"/>
                            <field name="client_name"/>
                            <field name="business_area"/>
                            <field name="business_area_other" attrs="{'invisible': [('business_area', '!=', 'other')], 'required': [('business_area', '=', 'other')]}"/>
                        </group>
                        <group>
                            <field name="active"/>
                            <field name="last_accessed" readonly="1"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Credenciais Odoo" name="odoo_credentials">
                            <group>
                                <group>
                                    <field name="odoo_url"/>
                                    <field name="odoo_db"/>
                                    <field name="odoo_username"/>
                                </group>
                                <group>
                                    <field name="odoo_password" password="True"/>
                                    <field name="odoo_api_key" password="True"/>
                                    <field name="timeout"/>
                                    <field name="verify_ssl"/>
                                </group>
                            </group>
                        </page>
                        <page string="Configurações Adicionais" name="additional_settings">
                            <group string="Sistema de IA">
                                <group>
                                    <field name="ai_system_url" placeholder="https://ai-system.example.com"/>
                                    <field name="use_ngrok"/>
                                    <field name="ngrok_url" attrs="{'invisible': [('use_ngrok', '=', False)], 'required': [('use_ngrok', '=', True)]}" placeholder="https://xxxx-xxx-xxx.ngrok.io"/>
                                </group>
                            </group>
                            <group string="Armazenamento">
                                <group>
                                    <field name="qdrant_collection"/>
                                </group>
                                <group>
                                    <field name="redis_prefix"/>
                                </group>
                            </group>
                        </page>
                        <page string="Redes Sociais" name="social_media">
                            <group string="Facebook">
                                <group>
                                    <field name="facebook_app_id"/>
                                    <field name="facebook_app_secret" password="True"/>
                                </group>
                                <group>
                                    <field name="facebook_access_token" password="True"/>
                                </group>
                            </group>
                            <group string="Instagram">
                                <group>
                                    <field name="instagram_client_id"/>
                                    <field name="instagram_client_secret" password="True"/>
                                </group>
                                <group>
                                    <field name="instagram_access_token" password="True"/>
                                </group>
                            </group>
                        </page>
                        <page string="Marketplaces" name="marketplaces">
                            <group string="Mercado Livre">
                                <group>
                                    <field name="mercadolivre_app_id"/>
                                    <field name="mercadolivre_client_secret" password="True"/>
                                </group>
                                <group>
                                    <field name="mercadolivre_access_token" password="True"/>
                                </group>
                            </group>
                        </page>
                        <page string="Notas" name="notes">
                            <field name="notes"/>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Visualização de árvore para credenciais -->
    <record id="view_ai_system_credentials_tree" model="ir.ui.view">
        <field name="name">ai.system.credentials.tree</field>
        <field name="model">ai.system.credentials</field>
        <field name="arch" type="xml">
            <tree string="Credenciais do Sistema de IA">
                <field name="name"/>
                <field name="account_id"/>
                <field name="client_name"/>
                <field name="business_area"/>
                <field name="odoo_url"/>
                <field name="odoo_db"/>
                <field name="last_accessed"/>
                <field name="active"/>
            </tree>
        </field>
    </record>

    <!-- Visualização de pesquisa para credenciais -->
    <record id="view_ai_system_credentials_search" model="ir.ui.view">
        <field name="name">ai.system.credentials.search</field>
        <field name="model">ai.system.credentials</field>
        <field name="arch" type="xml">
            <search string="Credenciais do Sistema de IA">
                <field name="name"/>
                <field name="account_id"/>
                <field name="client_name"/>
                <field name="token"/>
                <filter string="Ativos" name="active" domain="[('active', '=', True)]"/>
                <filter string="Inativos" name="inactive" domain="[('active', '=', False)]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Área de Negócio" name="group_by_business_area" context="{'group_by': 'business_area'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Visualização de árvore para logs de acesso -->
    <record id="view_ai_credentials_access_log_tree" model="ir.ui.view">
        <field name="name">ai.credentials.access.log.tree</field>
        <field name="model">ai.credentials.access.log</field>
        <field name="arch" type="xml">
            <tree string="Logs de Acesso às Credenciais" create="false" edit="false" delete="false">
                <field name="access_time"/>
                <field name="credential_id"/>
                <field name="user_id"/>
                <field name="ip_address"/>
                <field name="operation"/>
                <field name="success"/>
            </tree>
        </field>
    </record>

    <!-- Visualização de formulário para logs de acesso -->
    <record id="view_ai_credentials_access_log_form" model="ir.ui.view">
        <field name="name">ai.credentials.access.log.form</field>
        <field name="model">ai.credentials.access.log</field>
        <field name="arch" type="xml">
            <form string="Log de Acesso às Credenciais" create="false" edit="false" delete="false">
                <sheet>
                    <group>
                        <group>
                            <field name="access_time"/>
                            <field name="credential_id"/>
                            <field name="operation"/>
                        </group>
                        <group>
                            <field name="user_id"/>
                            <field name="ip_address"/>
                            <field name="success"/>
                        </group>
                    </group>
                    <group string="Detalhes do Erro" attrs="{'invisible': [('success', '=', True)]}">
                        <field name="error_message" nolabel="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- Visualização de pesquisa para logs de acesso -->
    <record id="view_ai_credentials_access_log_search" model="ir.ui.view">
        <field name="name">ai.credentials.access.log.search</field>
        <field name="model">ai.credentials.access.log</field>
        <field name="arch" type="xml">
            <search string="Logs de Acesso às Credenciais">
                <field name="credential_id"/>
                <field name="user_id"/>
                <field name="ip_address"/>
                <filter string="Sucesso" name="success" domain="[('success', '=', True)]"/>
                <filter string="Falha" name="failure" domain="[('success', '=', False)]"/>
                <group expand="0" string="Agrupar Por">
                    <filter string="Credencial" name="group_by_credential" context="{'group_by': 'credential_id'}"/>
                    <filter string="Usuário" name="group_by_user" context="{'group_by': 'user_id'}"/>
                    <filter string="Operação" name="group_by_operation" context="{'group_by': 'operation'}"/>
                    <filter string="Data" name="group_by_date" context="{'group_by': 'access_time:day'}"/>
                </group>
            </search>
        </field>
    </record>
</odoo>
